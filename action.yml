name: Launch a workflow using Nextflow Tower
author: Phil Ewels

description: Launch a workflow on Nextflow Tower

branding:
  icon: 'play'
  color: 'purple'

inputs:
  bearer_token:
    description: Nextflow Tower bearer token
    required: true
  compute_env:
    description: Nextflow Tower compute env
    required: true
  workspace_id:
    description: Nextflow Tower workspace ID
    required: false
  pipeline:
    description: Pipeline repository
    default: github.repository
    required: false
  revision:
    description: Pipeline revision (release / branch)
    default: github.sha
    required: false
  workdir:
    description: Nextflow work directory
    required: true
  parameters:
    description: Pipeline parameters
    default: '{}'
    required: false
  profiles:
    description: Nextflow config profiles
    default: '[]'
    required: false

runs:
  using: 'docker'
  image: Dockerfile
  env:
    TOWER_WORKSPACE_ID: ${{ inputs.workspace_id }}
    TOWER_BEARER_TOKEN: ${{ inputs.bearer_token }}
    TOWER_COMPUTE_ENV: ${{ inputs.compute_env }}
    PIPELINE: ${{ inputs.pipeline }}
    REVISION: ${{ inputs.revision }}
    WORKDIR: ${{ inputs.workdir }}
    PARAMETERS: ${{ toJson(fromJson(inputs.parameters)) }}
    CONFIG_PROFILES: ${{ toJson(fromJson(inputs.profiles)) }}
